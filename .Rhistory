demo <- read.delim("data-raw/demographic.txt")
y <- demo$bmi[match(rownames(count), demo$pid)]
bmi_gut = data.frame(bmi = y, x)
save(bmi_gut, file = "data/bmi_gut.rda", compress = "bzip2")
bmi_gut
library(compotools)
?care
bmi_gut
data("bmi_gut")
Veiw(bmi_gut)
Viww(bmi_gut)
View(bmi_gut)
data("bmi_gut")
View(bmi_gut)
install.packages('rmarkdown')
library(rmarkdown)
library(compotools)
data("bmi_gut")
View(bmi_gut)
count <- read.table("data-raw/combo_count_tab.txt")
depth <- sapply(strsplit(colnames(count), "\\."), length)
x <- count[, depth == 6 & colSums(count != 0) >= 1]
demo <- read.delim("data-raw/demographic.txt")
y <- demo$bmi[match(rownames(count), demo$pid)]
bmi_gut = data.frame(bmi = y, x)
save(bmi_gut, file = "data/bmi_gut.rda", compress = "bzip2")
data("bmi_gut")
View(bmi_gut)
library(compotools)
data("bmi_gut")
View(bmi_gut)
rowSums(bmi_gut)
nreads = rowSums(bmi_gut)
y = bmi_gut$bmi
x = bmi_gut[,-'bmi']
x = bmi_gut[,-c('bmi')]
x = bmi_gut[,setdiff(colnames(bmi_gut), "bmi")]
knitr::opts_chunk$set(echo = TRUE)
nreads = rowSums(x)
nreads = rowSums(x)
mean(nreads)
sd(nreads)
length(nreads)
View(x)
x
x = x/rowSums(x)
rowSums(x)
x[x==0] = 0.5
x = x/rowSums(x)
result = gic.cdmm(y, x)
z = log(as.matrix(x))
result = gic.cdmm(y, z)
result
colnames(x)[result$bet != 0]
z = log(as.matrix(x))
result = cv.cdmm(y, z, nfold = 10)
result
z = log(as.matrix(x))
result = gic.cdmm(y, z, nfold = 10)
z = log(as.matrix(x))
result = gic.cdmm(y, z)
result
knitr::opts_chunk$set(echo = TRUE)
library(compotools)
data("bmi_gut") # load example data
y = bmi_gut$bmi
x = bmi_gut[,setdiff(colnames(bmi_gut), "bmi")]
nreads = rowSums(x) # how many reads a sample has
mean(nreads)
sd(nreads)
x[x==0] = 0.5
x = x/rowSums(x)
z = log(as.matrix(x))
result = gic.cdmm(y, z)
result
colnames(x)[result$bet != 0]
z_selected = z[,result$bet != 0]
refitted_model = cdmm(y, z_selected, lam = 0)
refitted_model
knitr::opts_chunk$set(echo = TRUE)
library(compotools)
data("bmi_gut") # load example data
y = bmi_gut$bmi
x = bmi_gut[,setdiff(colnames(bmi_gut), "bmi")]
nreads = rowSums(x) # how many reads a sample has
mean(nreads)
sd(nreads)
x[x==0] = 0.5
x = x/rowSums(x)
z = log(as.matrix(x))
set.seed(1234)
result = gic.cdmm(y, z)
result
colnames(x)[result$bet != 0]
knitr::opts_chunk$set(echo = TRUE)
library(compotools)
data("bmi_gut") # load example data
y = bmi_gut$bmi
x = bmi_gut[,setdiff(colnames(bmi_gut), "bmi")]
nreads = rowSums(x) # how many reads a sample has
mean(nreads)
sd(nreads)
x[x==0] = 0.5
x = x/rowSums(x)
z = log(as.matrix(x))
set.seed(1234)
result = gic.cdmm(y, z)
result
colnames(x)[result$bet != 0]
knitr::opts_chunk$set(echo = TRUE)
library(compotools)
data("bmi_gut") # load example data
y = bmi_gut$bmi
x = bmi_gut[,setdiff(colnames(bmi_gut), "bmi")]
nreads = rowSums(x) # how many reads a sample has
mean(nreads)
sd(nreads)
x[x==0] = 0.5
x = x/rowSums(x)
z = log(as.matrix(x))
set.seed(46)
result = gic.cdmm(y, z)
result
colnames(x)[result$bet != 0]
knitr::opts_chunk$set(echo = TRUE)
library(compotools)
data("bmi_gut") # load example data
y = bmi_gut$bmi
x = bmi_gut[,setdiff(colnames(bmi_gut), "bmi")]
nreads = rowSums(x) # how many reads a sample has
mean(nreads)
sd(nreads)
x[x==0] = 0.5
x = x/rowSums(x)
z = log(as.matrix(x))
set.seed(1234)
n = nrow(z)
tarin_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt)
model
yt
zt
train_idx
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt)
model
z
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(y, z)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.8))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(y, z)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(y, z)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(y, z)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.8))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.9))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*1))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt)
model
colnames(x)[result$bet != 0]
colnames(x)[model$bet != 0]
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt)
model
dim(zt)
dim(y)
length(y)
length(yt)
r = cdmm(yt, zt)
r
View(r$bet)
model$lam
r$lam
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = n-1)
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = n)
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt)
model
r7 = cdmm(yt, zt)
r7$lam
r7$bet[r7$lam == 7.767513]
r7$bet[r7$lam == 7.767513]
r7$bet
dim(r7$lam)
col(r7$lam)
ncol(r7$lam)
nrow(r7$lam)
r7$lam
ncol(r7$bet)
length(r7$lam)
r = cdmm(y,z)
len(r$lam)
length(r$lam)
r$lam
r7$lam
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt, nlam = 200)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt, nlam = 10)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = gic.cdmm(yt, zt, nlam = 100)
model
set.seed(1234)
n = nrow(z)
train_idx = sample(1:n, size = floor(n*0.7))
zt = z[train_idx,]
yt = y[train_idx]
zv = z[-train_idx,]
yv = y[-train_idx]
model = cv.cdmm(yt, zt)
model
colnames(x)[model$bet != 0]
z_selected = z[,result$bet != 0]
z_selected = z[,model$bet != 0]
refitted_model = cdmm(y, z_selected, lam = 0)
refitted_model
yp = refitted_model$int + zv %*% refitted_model$bet
zv
dim(zv)
refitted_model$bet
selected = model$bet != 0
refitted_model = cdmm(yt, zt[,selected], lam = 0)
refitted_model
yp = refitted_model$int + zv[,selected] %*% refitted_model$bet
yp
yp = refitted_model$int + zv[,selected] %*% refitted_model$bet
plot(yv, yp)
plot(yv, yp,
asp = 1,
xlab = "observed", ylab = "predict",
)
abline(a = 0, b = 1, lty = 2, col = "grey")  # a=0截距，b=1斜率，红色虚线更醒目
yp <- refitted_model$int + zv[, selected] %*% refitted_model$bet
data_range = range(c(yv, yp))
plot(yv, yp,
xlim = data_range,
ylim = data_range,
asp = 1,
xlab = "observed", ylab = "predict",
)
abline(a = 0, b = 1, lty = 2, col = "grey")  # a=0截距，b=1斜率，红色虚线更醒目
data_range
?plot
yp <- refitted_model$int + zv[, selected] %*% refitted_model$bet
ran = range(c(yv, yp))
plot(yv, yp,
xlim = ran,
ylim = ran,
asp = 1,
xlab = "observed", ylab = "predict",
)
abline(a = 0, b = 1, lty = 2, col = "grey")
yp <- refitted_model$int + zv[, selected] %*% refitted_model$bet
ran = range(c(yv, yp))
plot(yv, yp,
xlim = ran,
ylim = ran,
asp = 1,
xlab = "observed", ylab = "predict",
)
abline(a = 0, b = 1, lty = 2, col = "grey")
yp <- refitted_model$int + zv[, selected] %*% refitted_model$bet
ran = range(c(yv, yp))
plot(yv, yp,
xlim = ran,
ylim = ran,
asp = 1,
xlab = "observed BMI", ylab = "predicted BMI",
)
abline(a = 0, b = 1, lty = 2, col = "grey")
matrix(1,1,6)
c(1:6) %*% matrix(1,1,6)
#----------------------------------------------------------------
powerFun <- function(x1,x2,propSubset,nRep){
nRej <- 0
n1 <- dim(x1)[1]
n2 <- dim(x2)[1]
n1Subset <- ceiling(n1*propSubset)
n2Subset <- ceiling(n2*propSubset)
for (i in 1:nRep) {
x1subset <- x1[sample(n1, n1Subset, replace = TRUE),]
x2subset <- x2[sample(n2, n2Subset, replace = TRUE),]
pX <- pValue(x1subset,x2subset)
if (pX < 0.05) {
nRej <- nRej + 1
}
}
power <- nRej/nRep
return(power)
}
#------------------------------------------------------------------------------------
pValue <- function(x1,x2){
n1 <- dim(x1)[1]
n2 <- dim(x2)[1]
p <- ncol(x1)
x1mean <- colSums(x1)/n1
x2mean <- colSums(x2)/n2
x1Var <- diag(var(x1))*(n1-1)/n1
x2Var <- diag(var(x2))*(n2-1)/n2
xStatVar <- (x1Var*n1 + x2Var*n2)/(n1*n2)
xStat <- max((x1mean/sqrt(xStatVar) - x2mean/sqrt(xStatVar))^2)
pvalue <- 1-exp(-1/sqrt(pi)*exp(-(xStat-(2*log(p)-log(log(p))))/2))
return(pvalue)
}
#------------------------------------------------------------------------------------
pValueBS <- function(x1,x2,nRep){
nx1 <- dim(x1)[1]
nx2 <- dim(x2)[1]
pValueList <- c()
for (i in 1:nRep) {
x1BSSet <- x1[sample(nx1, nx1, replace = TRUE),]
x2BSSet <- x2[sample(nx2, nx2, replace = TRUE),]
pValueList <- c(pValueList,pValue(x1BSSet,x2BSSet))
}
return(pValueList)
}
#------------------------------------------------------------------------------------
pValueBkTest <- function(x1,x2,nRep){
n1 <- dim(x1)[1]
n2 <- dim(x2)[1]
xTot <- rbind2(x1,x2)
pvalueList <- c()
for (i in 1:nRep) {
index <- sample(n1+n2, n1+n2, replace = FALSE)
x1BkTSet <- xTot[index[1:n1],]
x2BkTSet <- xTot[index[(n1+1):(n1+n2)],]
pvalueList <- c(pvalueList,pValue(x1BkTSet,x2BkTSet))
}
return(pvalueList)
}
require(ggplot2)
require(reshape)
set.seed(150)
source("D:/硕士毕业论文/code/compotools/compotools/R/two_sample_test.R", echo=TRUE)
xle = x[y<25]
xle = x[y<25,]
xob = x[y>=25,]
source("D:/硕士毕业论文/code/compotools/compotools/R/two_sample_test.R", echo=TRUE)
xle = x[y<25,]
xob = x[y>=25,]
cd.test(xle, xob, paired = FALSE)
source("D:/硕士毕业论文/code/compotools/compotools/R/two_sample_test.R", echo=TRUE)
xle = x[y<25,]
xob = x[y>=25,]
cd.test(xle, xob, paired = FALSE)
xle = x[y<25,]
xob = x[y>=25,]
p.value = cd.test(xle, xob, paired = FALSE)
print(p.value)
source("D:/硕士毕业论文/code/compotools/compotools/R/coat.R", echo=TRUE)
r = cv.coat(xle)
source("D:/硕士毕业论文/code/compotools/compotools/R/coat.R", echo=TRUE)
r = cv.coat(xle)
r$lam
r$sigma
View(r$sigma)
r = cv.coat(xle)
source("D:/硕士毕业论文/code/compotools/compotools/R/coat.R", echo=TRUE)
r = coat(xle)
source("D:/硕士毕业论文/code/compotools/compotools/R/coat.R", echo=TRUE)
r = coat(xle)
source("D:/硕士毕业论文/code/compotools/compotools/R/coat.R", echo=TRUE)
source("D:/硕士毕业论文/code/compotools/compotools/R/coat.R", echo=TRUE)
r = coat(xle)
r = coat(xle)
source("D:/硕士毕业论文/code/compotools/compotools/R/coat.R", echo=TRUE)
r = coat(xle)
r$lam
?drop
r$sigma
rcv = cv.coat(xle)
rcv$lam
which(r$lam == rcv$lam)
r$lam
source("D:/硕士毕业论文/code/compotools/compotools/R/coat.R", echo=TRUE)
r = coat(xle)
rcv = cv.coat(xle)
which(r$lam == rcv$lam)
ilam = which(r$lam == rcv$lam)
r$sigma[ilam,,]==rcv$sigma
all(r$sigma[ilam,,]==rcv$sigma)
source("D:/硕士毕业论文/code/compotools/compotools/R/coat.R", echo=TRUE)
rcv = cv.coat(xle)
foldid = sample(1:n) %% 55
foldid = sample(1:n) %% 5
foldid
foldid = sample(1:n) %% 5
rcv = cv.coat(xle, foldid = foldid)
foldid = sample(1:nrow(xle)) %% 5
rcv = cv.coat(xle, foldid = foldid)
